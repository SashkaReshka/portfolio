<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü—Ä–æ—î–∫—Ç–∏ ‚Äî –û–ª–µ–∫—Å–∞–Ω–¥—Ä</title>
  <meta name="description" content="–ü–æ—Ä—Ç—Ñ–æ–ª—ñ–æ –ø—Ä–æ—î–∫—Ç—ñ–≤: –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∏, –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∏, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏">
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="css/main.css" />
</head>
<body>
  <div class="layout">
    <aside id="navigation"></aside>

    <main>
      <div class="container">
        <!-- –•–ª—ñ–±–Ω—ñ –∫—Ä–∏—Ö—Ç–∏ -->
        <div id="breadcrumbs-container"></div>
        
        <section class="section">
          <h1>–ü—Ä–æ—î–∫—Ç–∏</h1>
          <p class="meta">–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∏ –¥–ª—è B2B-–∫–ª—ñ—î–Ω—Ç—ñ–≤</p>
          
          <!-- –ü–æ—à—É–∫ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∏ -->
          <div class="search-filters">
            <!-- –ü–æ—à—É–∫ -->
            <div class="search-box">
              <input 
                type="search" 
                id="search-input" 
                class="search-field" 
                placeholder="üîç –ü–æ—à—É–∫ –ø—Ä–æ—î–∫—Ç—ñ–≤..."
                aria-label="–ü–æ—à—É–∫ –ø—Ä–æ—î–∫—Ç—ñ–≤"
              />
            </div>
            
            <!-- –§—ñ–ª—å—Ç—Ä–∏ –ø–æ —Ç–µ–≥–∞—Ö -->
            <div class="filter-tags" id="filter-tags">
              <button class="filter-tag active" data-tag="all">
                –í—Å—ñ
              </button>
              <!-- –Ü–Ω—à—ñ —Ç–µ–≥–∏ –¥–æ–¥–∞–¥—É—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
          </div>
          
          <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
          <div class="results-info" id="results-info">
            –ü–æ–∫–∞–∑–∞–Ω–æ: <strong id="results-count">0</strong> –ø—Ä–æ—î–∫—Ç—ñ–≤
          </div>
          
          <!-- –°—ñ—Ç–∫–∞ –ø—Ä–æ—î–∫—Ç—ñ–≤ -->
          <div id="projects-grid" class="grid cols-3">
            <div class="loading-state">
              <div class="spinner"></div>
              <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤...</p>
            </div>
          </div>
          
          <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —è–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ -->
          <div id="no-results" class="no-results" style="display: none;">
            <h3>–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—ó –ø–æ—à—É–∫—É</p>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- JavaScript -->
  <script src="js/utils.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/nav.js"></script>
  <script src="js/breadcrumbs.js"></script>
  <script>
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è breadcrumbs –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—Ä–æ—î–∫—Ç—ñ–≤
    document.addEventListener('DOMContentLoaded', () => {
      if (window.initBreadcrumbs) {
        window.initBreadcrumbs();
      }
    });
  </script>
  <script>
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤ –∑ –ø–æ—à—É–∫–æ–º —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏
    let allProjects = [];
    let filteredProjects = [];
    let currentTag = 'all';
    let currentSearch = '';

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤
    async function loadAllProjects() {
      try {
        const response = await fetch('data/projects/index.json');
        if (!response.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è');
        
        allProjects = await response.json();
        filteredProjects = allProjects;
        
        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
        generateTagFilters();
        
        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤
        displayProjects();
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—à—É–∫—É
        initSearch();
      } catch (error) {
        console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        showError();
      }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤
    function generateTagFilters() {
      const allTags = window.utils.getAllTags(allProjects);
      const container = document.getElementById('filter-tags');
      
      allTags.forEach(tag => {
        const button = document.createElement('button');
        button.className = 'filter-tag';
        button.dataset.tag = tag;
        button.textContent = tag;
        button.onclick = () => filterByTag(tag);
        container.appendChild(button);
      });
    }

    // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ —Ç–µ–≥—É
    function filterByTag(tag) {
      currentTag = tag;
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI –∫–Ω–æ–ø–æ–∫
      document.querySelectorAll('.filter-tag').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tag === tag);
      });
      
      // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ—î–∫—Ç—ñ–≤
      if (tag === 'all') {
        filteredProjects = currentSearch 
          ? window.utils.searchItems(allProjects, currentSearch, ['title', 'description', 'role', 'tags'])
          : allProjects;
      } else {
        const tagFiltered = window.utils.filterByTag(allProjects, tag);
        filteredProjects = currentSearch
          ? window.utils.searchItems(tagFiltered, currentSearch, ['title', 'description', 'role', 'tags'])
          : tagFiltered;
      }
      
      displayProjects();
    }

    // –ü–æ—à—É–∫
    function initSearch() {
      const searchInput = document.getElementById('search-input');
      
      const handleSearch = window.utils.debounce((e) => {
        const query = e.target.value.trim();
        currentSearch = query;
        
        // –Ø–∫—â–æ —î –ø–æ—à—É–∫, —Å–∫–∏–¥–∞—î–º–æ —Ñ—ñ–ª—å—Ç—Ä –Ω–∞ "–í—Å—ñ"
        if (query !== '') {
          currentTag = 'all';
          document.querySelectorAll('.filter-tag').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.tag === 'all');
          });
        }
        
        // –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
        if (query === '' && currentTag === 'all') {
          filteredProjects = allProjects;
        } else if (query === '') {
          filteredProjects = window.utils.filterByTag(allProjects, currentTag);
        } else {
          const searchBase = currentTag === 'all' ? allProjects : window.utils.filterByTag(allProjects, currentTag);
          filteredProjects = window.utils.searchItems(searchBase, query, ['title', 'description', 'role', 'tags']);
        }
        
        displayProjects();
      }, 300);
      
      searchInput.addEventListener('input', handleSearch);
    }

    // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤
    function displayProjects() {
      const grid = document.getElementById('projects-grid');
      const noResults = document.getElementById('no-results');
      const resultsCount = document.getElementById('results-count');
      
      resultsCount.textContent = filteredProjects.length;
      
      if (filteredProjects.length === 0) {
        grid.style.display = 'none';
        noResults.style.display = 'block';
        return;
      }
      
      grid.style.display = 'grid';
      noResults.style.display = 'none';
      
      grid.innerHTML = filteredProjects.map(project => `
        <a class="card" href="project.html?project=${project.slug}">
          <div class="thumb"></div>
          <div class="card-body">
            <h3>${highlightText(project.title)}</h3>
            <div class="meta">${project.role}</div>
            <p>${highlightText(project.description)}</p>
            ${project.tags ? `
              <div class="tags">
                ${project.tags.map(tag => `<span class="chip">#${tag}</span>`).join(' ')}
              </div>
            ` : ''}
          </div>
        </a>
      `).join('');
    }

    // –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –∑–Ω–∞–π–¥–µ–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç—É
    function highlightText(text) {
      if (!currentSearch) return text;
      
      const regex = new RegExp(`(${currentSearch})`, 'gi');
      return text.replace(regex, '<mark>$1</mark>');
    }

    // –ü–æ–∫–∞–∑ –ø–æ–º–∏–ª–∫–∏
    function showError() {
      const grid = document.getElementById('projects-grid');
      grid.innerHTML = `
        <div class="error-message">
          <h3>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h3>
          <p>–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–æ—î–∫—Ç–∏. –°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.</p>
        </div>
      `;
    }

    // –ó–∞–ø—É—Å–∫
    loadAllProjects();
  </script>
</body>
</html>
