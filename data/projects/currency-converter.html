<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç ‚Äî –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –∫—É—Ä—Å –ù–ë–£ ‚Ä¢ –û–ª–µ–∫—Å–∞–Ω–¥—Ä</title>
  <meta name="description" content="–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç –∑–∞ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –∫—É—Ä—Å–æ–º –ù–ë–£. –í–∏–±—ñ—Ä –¥–∞—Ç–∏, –ø–æ–Ω–∞–¥ 15 –≤–∞–ª—é—Ç, –º–∏—Ç—Ç—î–≤–∏–π –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫.">
  <meta name="color-scheme" content="light dark" />
  
  <!-- –ú–æ–¥—É–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ —Å–∞–π—Ç—É -->
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/navigation.css" />
  <link rel="stylesheet" href="../css/components.css" />
  <link rel="stylesheet" href="../css/sections.css" />
  <link rel="stylesheet" href="../css/calculators.css" />
  <link rel="stylesheet" href="../css/mobile.css" />
</head>
<body>
  <div class="layout">
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
    <aside id="navigation"></aside>

    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main>
      <div class="container">
        <!-- Breadcrumbs -->
        <nav class="breadcrumbs">
          <div class="breadcrumb-item">
            <a href="../index.html" class="breadcrumb-link breadcrumb-home">üè†</a>
          </div>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <div class="breadcrumb-item">
            <a href="../projects.html" class="breadcrumb-link">Interactive Lab</a>
          </div>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <div class="breadcrumb-item">
            <span class="breadcrumb-current">–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç</span>
          </div>
        </nav>

        <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
        <div class="calculator-wrapper">
          <div class="calculator-card">
            <!-- –•–µ–¥–µ—Ä -->
            <div class="calc-header">
              <h1>üí± –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –≤–∞–ª—é—Ç</h1>
              <p>–ö–æ–Ω–≤–µ—Ä—Ç—É–π—Ç–µ –≤–∞–ª—é—Ç–∏ –∑–∞ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º –∫—É—Ä—Å–æ–º –ù–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫—É –£–∫—Ä–∞—ó–Ω–∏</p>
              <div class="calc-badge">
                <span class="calc-badge-icon">üèõÔ∏è</span>
                –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –∫—É—Ä—Å –ù–ë–£
              </div>
            </div>

            <!-- –¢—ñ–ª–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
            <div class="calc-body">
              <!-- –î–∞—Ç–∞ —ñ —Å—É–º–∞ -->
              <div class="calc-grid-2">
                <div class="calc-form-group">
                  <label class="calc-label">–î–∞—Ç–∞ –∫—É—Ä—Å—É</label>
                  <input 
                    type="date" 
                    id="datePick" 
                    class="calc-input"
                  />
                </div>
                <div class="calc-form-group">
                  <label class="calc-label">–°—É–º–∞</label>
                  <div class="calc-input-icon">
                    <input 
                      type="number" 
                      id="amount" 
                      class="calc-input" 
                      min="0" 
                      step="0.01" 
                      value="100"
                      placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É"
                    />
                  </div>
                </div>
              </div>

              <!-- –í–∏–±—ñ—Ä –≤–∞–ª—é—Ç -->
              <div class="calc-grid-swap">
                <div class="calc-form-group">
                  <label class="calc-label">–ó –≤–∞–ª—é—Ç–∏</label>
                  <div class="calc-select-wrapper">
                    <select id="currencyFrom" class="calc-select"></select>
                  </div>
                </div>

                <button class="calc-swap-btn" id="btnSwap" title="–ü–æ–º—ñ–Ω—è—Ç–∏ –º—ñ—Å—Ü—è–º–∏">
                  ‚áÑ
                </button>

                <div class="calc-form-group">
                  <label class="calc-label">–£ –≤–∞–ª—é—Ç—É</label>
                  <div class="calc-select-wrapper">
                    <select id="currencyTo" class="calc-select"></select>
                  </div>
                </div>
              </div>

              <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
              <div class="calc-result" id="result">
                <div class="calc-result-label" id="resultLabel">
                  –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
                </div>
                <div class="calc-result-value" id="resultValue">
                  ‚Äî
                </div>
                <div class="calc-result-meta" id="resultMeta">
                  –ö—É—Ä—Å: ‚Äî ‚Ä¢ –°—Ç–∞–Ω–æ–º –Ω–∞: ‚Äî
                </div>
              </div>

              <!-- –ü–æ–º–∏–ª–∫–∞ -->
              <div class="calc-error" id="error">
                –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ –≤—ñ–¥ –ù–ë–£. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à—É –¥–∞—Ç—É –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑'—î–¥–Ω–∞–Ω–Ω—è.
              </div>

              <!-- –ü–ª–∏—Ç–∫–∏ –∑ –∫—É—Ä—Å–∞–º–∏ -->
              <div class="calc-tiles">
                <div class="calc-tile">
                  <div class="calc-tile-label">
                    UAH –∑–∞ 1 <span id="fromCode">‚Äî</span>
                  </div>
                  <div class="calc-tile-value" id="rateFrom">‚Äî</div>
                </div>
                <div class="calc-tile">
                  <div class="calc-tile-label">
                    UAH –∑–∞ 1 <span id="toCode">‚Äî</span>
                  </div>
                  <div class="calc-tile-value" id="rateTo">‚Äî</div>
                </div>
                <div class="calc-tile">
                  <div class="calc-tile-label">–ö—Ä–æ—Å-–∫—É—Ä—Å</div>
                  <div class="calc-tile-value" id="crossRate">‚Äî</div>
                </div>
              </div>

              <!-- –Ü–Ω—Ñ–æ -->
              <div class="calc-info">
                <strong>–Ø–∫ –ø—Ä–∞—Ü—é—î:</strong> –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –≥—Ä–∏–≤–Ω—é (UAH). 
                –ù–∞–ø—Ä–∏–∫–ª–∞–¥: USD ‚Üí UAH ‚Üí EUR. –ö—É—Ä—Å–∏ –ù–ë–£ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è —â–æ–¥–µ–Ω–Ω–æ –±–ª–∏–∑—å–∫–æ 12:00.
                –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –∫–µ—à—ñ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
              </div>
            </div>

            <!-- –§—É—Ç–µ—Ä -->
            <div class="calc-footer">
              <div class="calc-footer-text">
                ¬© 2025 ‚Ä¢ –î–∞–Ω—ñ –∑ bank.gov.ua
              </div>
              <div class="calc-footer-badge" id="cacheStatus">
                –ö–µ—à: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞...
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- JavaScript -->
  <script src="../js/theme.js"></script>
  <script src="../js/nav.js"></script>
  <script src="../js/utils.js"></script>
  
  <!-- –õ–æ–≥—ñ–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
  <script>
    (function() {
      'use strict';
      
      // ========================================
      // –ï–õ–ï–ú–ï–ù–¢–ò DOM
      // ========================================
      const elements = {
        date: document.getElementById('datePick'),
        amount: document.getElementById('amount'),
        from: document.getElementById('currencyFrom'),
        to: document.getElementById('currencyTo'),
        swap: document.getElementById('btnSwap'),
        result: document.getElementById('result'),
        resultLabel: document.getElementById('resultLabel'),
        resultValue: document.getElementById('resultValue'),
        resultMeta: document.getElementById('resultMeta'),
        rateFrom: document.getElementById('rateFrom'),
        rateTo: document.getElementById('rateTo'),
        fromCode: document.getElementById('fromCode'),
        toCode: document.getElementById('toCode'),
        crossRate: document.getElementById('crossRate'),
        error: document.getElementById('error'),
        cacheStatus: document.getElementById('cacheStatus')
      };

      // ========================================
      // –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø
      // ========================================
      const NBU_API = 'https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange';
      const LOCALE = 'uk-UA';
      
      // –§–æ—Ä–º–∞—Ç—Ç–µ—Ä–∏ —á–∏—Å–µ–ª
      const formatter2 = new Intl.NumberFormat(LOCALE, {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
      
      const formatter4 = new Intl.NumberFormat(LOCALE, {
        minimumFractionDigits: 4,
        maximumFractionDigits: 4
      });

      // ========================================
      // –°–¢–ê–ù
      // ========================================
      let rates = new Map();
      let exchangeDate = null;

      // ========================================
      // –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
      // ========================================
      function init() {
        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É
        const today = new Date().toISOString().slice(0, 10);
        elements.date.value = today;
        
        // –ü–æ–¥—ñ—ó
        elements.date.addEventListener('change', loadRates);
        elements.amount.addEventListener('input', calculate);
        elements.from.addEventListener('change', calculate);
        elements.to.addEventListener('change', calculate);
        elements.swap.addEventListener('click', swapCurrencies);
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫—É—Ä—Å–∏
        loadRates();
      }

      // ========================================
      // –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ö–£–†–°–Ü–í
      // ========================================
      async function loadRates() {
        try {
          hideError();
          
          const dateISO = elements.date.value || new Date().toISOString().slice(0, 10);
          const dateYMD = dateISO.replace(/-/g, '');
          
          // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–µ—à—É
          const cacheKey = `nbu_rates_${dateYMD}`;
          const cached = localStorage.getItem(cacheKey);
          
          if (cached) {
            const data = JSON.parse(cached);
            applyRates(data);
            elements.cacheStatus.textContent = '–ö–µ—à: localStorage ‚úì';
            return;
          }
          
          // –ó–∞–ø–∏—Ç –¥–æ API
          elements.cacheStatus.textContent = '–ö–µ—à: –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
          const url = `${NBU_API}?date=${dateYMD}&json`;
          const response = await fetch(url, { cache: 'no-store' });
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          
          const data = await response.json();
          
          // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ –∫–µ—à
          const cacheData = { list: data, dateISO };
          localStorage.setItem(cacheKey, JSON.stringify(cacheData));
          
          applyRates(cacheData);
          elements.cacheStatus.textContent = '–ö–µ—à: –æ–Ω–æ–≤–ª–µ–Ω–æ ‚úì';
          
        } catch (error) {
          console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤:', error);
          showError();
          elements.cacheStatus.textContent = '–ö–µ—à: –ø–æ–º–∏–ª–∫–∞ ‚úó';
        }
      }

      // ========================================
      // –ó–ê–°–¢–û–°–£–í–ê–ù–ù–Ø –ö–£–†–°–Ü–í
      // ========================================
      function applyRates(payload) {
        rates.clear();
        
        // –î–æ–¥–∞—î–º–æ UAH (—Å–∏–Ω—Ç–µ—Ç–∏—á–Ω–∞ –≤–∞–ª—é—Ç–∞)
        rates.set('UAH', {
          cc: 'UAH',
          txt: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –≥—Ä–∏–≤–Ω—è',
          rate: 1,
          exchangedate: formatDate(payload.dateISO)
        });
        
        // –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –∫—É—Ä—Å–∏ –≤—ñ–¥ –ù–ë–£
        (payload.list || []).forEach(item => {
          if (item && item.cc && typeof item.rate === 'number') {
            rates.set(item.cc.toUpperCase(), {
              cc: item.cc.toUpperCase(),
              txt: item.txt,
              rate: item.rate,
              exchangedate: item.exchangedate
            });
          }
        });
        
        exchangeDate = payload.dateISO;
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ–ª–µ–∫—Ç–∏
        buildSelects();
        
        // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ
        calculate();
      }

      // ========================================
      // –ü–û–ë–£–î–û–í–ê –°–ï–õ–ï–ö–¢–Ü–í
      // ========================================
      function buildSelects() {
        const options = [];
        const preferred = ['UAH', 'USD', 'EUR', 'PLN', 'GBP', 'CHF', 'CZK', 'HUF', 'RON', 'TRY', 'CAD', 'JPY', 'CNY', 'GEL', 'MDL'];
        const seen = new Set();
        
        // –°–ø–æ—á–∞—Ç–∫—É –ø–æ–ø—É–ª—è—Ä–Ω—ñ
        preferred.forEach(code => {
          if (rates.has(code) && !seen.has(code)) {
            const currency = rates.get(code);
            options.push(new Option(`${code} ‚Äî ${currency.txt}`, code));
            seen.add(code);
          }
        });
        
        // –ü–æ—Ç—ñ–º —Ä–µ—à—Ç–∞ –ø–æ –∞–ª—Ñ–∞–≤—ñ—Ç—É
        Array.from(rates.keys()).sort().forEach(code => {
          if (!seen.has(code)) {
            const currency = rates.get(code);
            options.push(new Option(`${code} ‚Äî ${currency.txt}`, code));
          }
        });
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
        const prevFrom = elements.from.value;
        const prevTo = elements.to.value;
        
        // –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ–ª–µ–∫—Ç–∏
        elements.from.innerHTML = '';
        elements.to.innerHTML = '';
        
        options.forEach(opt => {
          elements.from.add(opt.cloneNode(true));
        });
        
        options.forEach(opt => {
          elements.to.add(opt.cloneNode(true));
        });
        
        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
        elements.from.value = prevFrom || 'USD';
        elements.to.value = prevTo || 'UAH';
      }

      // ========================================
      // –†–û–ó–†–ê–•–£–ù–û–ö
      // ========================================
      function calculate() {
        hideError();
        
        const amount = parseFloat(elements.amount.value) || 0;
        const fromCode = elements.from.value;
        const toCode = elements.to.value;
        
        if (!rates.size || !fromCode || !toCode) {
          elements.resultValue.textContent = '‚Äî';
          return;
        }
        
        const fromRate = rates.get(fromCode)?.rate;
        const toRate = rates.get(toCode)?.rate;
        
        if (!(fromRate > 0) || !(toRate > 0)) {
          elements.resultValue.textContent = '‚Äî';
          return;
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è: amount * (UAH/FROM) / (UAH/TO)
        const result = amount * (fromRate / toRate);
        const crossRate = fromRate / toRate;
        
        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
        elements.resultValue.textContent = isFinite(result) 
          ? `${formatter2.format(result)} ${toCode}` 
          : '‚Äî';
        
        elements.resultLabel.textContent = amount 
          ? `${formatter2.format(amount)} ${fromCode} =` 
          : '–†–µ–∑—É–ª—å—Ç–∞—Ç';
        
        elements.resultMeta.textContent = `–ö—É—Ä—Å: 1 ${fromCode} = ${formatter4.format(crossRate)} ${toCode} ‚Ä¢ ${formatDate(exchangeDate)}`;
        
        // –û–Ω–æ–≤–ª—é—î–º–æ –ø–ª–∏—Ç–∫–∏
        elements.rateFrom.textContent = `${formatter4.format(fromRate)} UAH`;
        elements.rateTo.textContent = `${formatter4.format(toRate)} UAH`;
        elements.fromCode.textContent = fromCode;
        elements.toCode.textContent = toCode;
        elements.crossRate.textContent = `${formatter4.format(crossRate)}`;
        
        // –ê–Ω—ñ–º–∞—Ü—ñ—è
        elements.result.classList.add('pulse');
        setTimeout(() => elements.result.classList.remove('pulse'), 400);
      }

      // ========================================
      // –û–ë–ú–Ü–ù –í–ê–õ–Æ–¢
      // ========================================
      function swapCurrencies() {
        const temp = elements.from.value;
        elements.from.value = elements.to.value;
        elements.to.value = temp;
        calculate();
      }

      // ========================================
      // –§–û–†–ú–ê–¢–£–í–ê–ù–ù–Ø –î–ê–¢–ò
      // ========================================
      function formatDate(isoDate) {
        if (!isoDate) return '‚Äî';
        const date = new Date(isoDate + 'T00:00:00');
        return date.toLocaleDateString('uk-UA', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      }

      // ========================================
      // –ü–û–ú–ò–õ–ö–ò
      // ========================================
      function showError() {
        elements.error.classList.add('show');
      }

      function hideError() {
        elements.error.classList.remove('show');
      }

      // ========================================
      // –ó–ê–ü–£–°–ö
      // ========================================
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
